根據目前專案改寫成vs code 工具專案


🧩 「類 Augment 開發助理」VS Code Extension 開發計畫 (v2.0)
🎯 專案最終目標
打造一款深度整合進 VS Code 的 AI 開發助理，它不僅能執行指令，更能主動理解專案的程式碼結構與 Git 脈絡。核心目標是建立一個能「觀察、理解、建議、執行」的完整開發工作流，功能涵蓋：

智能情境感知： 不再是傳送整個檔案，而是能透過程式碼索引 (Indexing) 與語法樹分析 (AST)，精準定位到函式、類別或特定行數，只將最相關的程式碼片段傳給 AI，大幅降低 Token 成本並提高回應品質。

多步任務代理： 能將一個模糊的開發需求（如「重構這個函式以提高可讀性」）拆解成具體的、可執行的步驟清單，並追蹤其完成狀態。

深度 Git 整合： 能分析 git diff 的變更，自動生成有意義的 Commit 訊息、PR 描述，並能比對歷史版本，確保開發方向沒有偏離初衷。

主動式程式碼工作流： 能自動偵測程式碼中的 TODO, FIXME 或 Linter 警告，並主動轉換為可執行的任務項。

🏛️ 一、核心架構與模組設計 (Top-Level Modules)
我們將專案拆分為以下幾個核心模組，其中「程式碼情境智能模組」是本計畫的靈魂。

模組名稱

核心職責

關鍵技術/思路

1. 核心架構與啟動

負責 Extension 的生命週期、指令註冊、設定載入與基礎事件監聽。

vscode API, extension.ts, package.json

2. 使用者介面與互動 (UI/UX)

透過 Webview、狀態列、通知、右鍵選單等方式，提供使用者操作介面與回饋。

WebviewPanel, StatusBarItem, Commands

3. AI 核心引擎

封裝與大型語言模型 (LLM) 的通訊邏輯，包含 API 請求、回應解析、錯誤處理與模型切換。

axios 或 openai SDK, claude-api 等

4. 程式碼情境智能模組

(本專案重點) 解析程式碼、建立索引、根據需求提取精準的上下文。

Tree-sitter (AST 解析), 向量資料庫 (如 LanceDB) 或本地索引

5. Git 整合模組

封裝所有 Git 相關操作，如讀取狀態、獲取 diff、查看歷史紀錄。

simple-git 或 isomorphic-git

6. 任務代理與工作流模組

管理由 AI 或使用者建立的開發任務，追蹤其狀態，並將其與程式碼變更連結。

自定義 TaskManager 類別, WorkspaceEdit API

7. 設定與狀態管理

持久化儲存 API 金鑰、使用者偏好設定、任務列表等。

vscode.workspaceState/globalState

✅ 二、詳細開發任務列表 (可依 Sprint 週期執行)
這份列表已依照功能依賴性排序，建議循序漸進開發。

Sprint 1: 奠定基礎 (MVP - Minimum Viable Product)
目標：建立一個可以運作的骨架，能選取程式碼、呼叫 AI 並在 Webview 顯示結果。

[ ] (架構) 使用 yo code 建立 TypeScript Extension 專案。

[ ] (架構) 註冊一個主指令 devAgent.start，並在右鍵選單中加入觸發點。

[ ] (設定) 在 package.json 與設定檔中，建立 devAgent.openaiApiKey 的設定項，並能安全讀取。

[ ] (AI 引擎) 建立一個 LLMService.ts，封裝一個基本的 axios POST 請求到 OpenAI API。

[ ] (UI/UX) 當指令觸發時，獲取當前編輯器選取的文字。

[ ] (UI/UX) 呼叫 LLMService，並將回傳結果顯示在一個基礎的 WebviewPanel 裡。

Sprint 2: 導入大腦 (程式碼情境智能)
目標：讓 Extension 開始「看得懂」程式碼，而不只是純文字。

[ ] (情境智能) 引入 Tree-sitter 與對應的語言文法 (e.g., tree-sitter-typescript, tree-sitter-python)。

[ ] (情境智能) 建立 CodeParser.ts，能將當前檔案內容解析成一棵 抽象語法樹 (AST)。

[ ] (情境智能) 實作符號索引 (Symbol Indexing) 功能：遍歷 AST，抽取出所有函式、類別、介面的名稱與其所在的行數範圍 (line range)，並存入記憶體中的索引。

[ ] (情境智能) 改造 devAgent.start 指令：

如果使用者游標停留在一個函式內（而非選取文字），自動找出該函式的邊界。

使用索引好的行數範圍，精準提取該函式的程式碼作為 AI 的輸入。

[ ] (UI/UX) 在 Webview 中，除了顯示 AI 回應，也要顯示這次送出的上下文來源（例如：file.ts, function fetchData(), lines 42-58）。

Sprint 3: 任務代理與 Git 整合
目標：將 AI 的建議轉化為可管理的任務，並開始與 Git 互動。

[ ] (任務代理) 建立 TaskManager.ts 與 Task 資料結構，每個任務應包含：id, description, status (pending, done), filePath, range。

[ ] (AI 引擎) 調整 Prompt，要求 AI 的回應盡量是可執行的步驟，並用特定格式（如 Markdown 列表）回傳。

[ ] (任務代理) 建立 ResponseParser.ts，將 AI 回傳的列表解析成 Task 物件陣列。

[ ] (UI/UX) 在 Webview 中用列表渲染這些任務，每個任務旁應有「完成」按鈕。

[ ] (Git 整合) 引入 simple-git，並建立 GitService.ts。

[ ] (Git 整合) 新增指令 devAgent.summarizeChanges：

使用 GitService 獲取 git diff --staged 的內容。

將 diff 內容傳給 AI，要求生成 Commit 訊息。

Sprint 4: 打造完整工作流
目標：將各模組串連起來，形成從分析到執行的閉環。

[ ] (UI/UX) 在任務列表的每個任務旁，新增「應用修改 (Apply Change)」按鈕。

[ ] (任務代理) 實作「應用修改」邏輯：當 AI 的建議是程式碼修改時，使用 vscode.WorkspaceEdit API 將變更直接應用到對應的檔案與行數。

[ ] (情境智能) 新增自動觸發機制：監聽檔案儲存事件，自動掃描程式碼中的 // TODO: 或 // FIXME:，並將其轉換為待辦任務顯示在 Webview 中。

[ ] (Git 整合) 擴充 devAgent.summarizeChanges，除了生成 Commit 訊息，也提供按鈕一鍵執行 git commit。

[ ] (狀態管理) 使用 context.workspaceState 將任務列表持久化儲存，關閉再打開 VS Code 後任務不會消失。

Sprint 5+: 拋光與擴展
目標：優化使用者體驗，並加入更多進階功能。

[ ] (UI/UX) 將 Webview UI 升級為 React 或 Svelte，提供更豐富的互動（如拖曳排序任務、篩選等）。

[ ] (AI 引擎) 支援切換不同模型（GPT-4, Claude, Gemini），並在設定中提供選項。

[ ] (情境智能) 探索專案級索引 (Project-wide Indexing)：在背景掃描整個專案，建立全域的函式/類別索引，實現跨檔案的上下文理解。

[ ] (任務代理) 支援多步任務鏈：讓 AI 將一個大任務拆解成多個有依賴關係的子任務。

[ ] (擴充) 整合測試框架：讓 AI 針對一個函式生成單元測試，並提供指令一鍵執行測試。

📦 三、技術選型建議
分類

建議技術

備註

Extension 框架

TypeScript + vscode API

官方標準，生態系最完整。

語法樹解析

Tree-sitter

效能極高，支援多種語言，是實現情境智能的關鍵。

Webview UI

React + Tailwind CSS (或 Svelte/Vue)

現代前端框架能有效管理複雜的 UI 狀態。

Git 操作

simple-git

成熟、穩定，功能強大的 Git 指令包裝器。

LLM 通訊

axios

輕量、靈活，足以應對 API 請求。

本地儲存

vscode.workspaceState

VS Code 內建的持久化儲存機制，最簡單可靠。

這份重構後的開發計畫，將程式碼情境智能作為核心競爭力，確保您的開發助理從一開始就走在正確的道路上。您可以按照 Sprint 的規劃，逐步實現一個真正強大且實用的工具。