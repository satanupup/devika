# 🧩 Devika VS Code Extension 開發指南

## 📋 專案概述

Devika VS Code Extension 是一個深度整合進 VS Code 的 AI 開發助理，設計為**類 Augment 插件系統**，具備程式碼情境理解、任務代理和 Git 整合功能。本專案採用**個體戶友善的敏捷開發方法**，適合單人或小團隊開發。

### 🎯 核心理念：打造 Augment-like 插件系統

本專案本質上是建立一個**會讀上下文、能執行工作流程、幫你改 VS Code 專案的 AI 助手**：

- **智能情境感知**: 透過程式碼索引和語法樹分析，精準定位相關程式碼片段
- **任務模組化**: 將複雜需求拆解成可重複使用的任務模組（Task Modules）
- **工作流自動化**: 自動執行重複性開發任務，如生成文件、重構程式碼
- **深度 Git 整合**: 分析變更、生成 Commit 訊息、追蹤開發歷史
- **代理模式**: 类似 Gemini Code Assist 的多步骤任务审核和批准机制
- **多文件并发编辑**: 智能识别并修改相关文件，支持大规模重构
- **完整项目上下文**: 深度理解项目架构、依赖关系和编码模式
- **检查点回滚**: 完整的变更历史和一键回滚功能

## 🏗️ 技術架構

### 📦 模組結構
```
devika/
├── devika-core/              # 🧠 平台無關的 AI 核心引擎
│   ├── interfaces/           # 抽象介面定義
│   ├── llm/                  # AI 模型服務
│   ├── context/              # 程式碼分析
│   ├── tasks/                # 任務管理
│   └── plugins/              # 插件系統
│
└── src/                      # 🎨 VS Code Extension 實作
    ├── adapters/             # devika-core 介面適配器
    ├── plugins/              # Augment 插件系統
    ├── ui/                   # VS Code UI 管理
    └── extension.ts          # 擴充功能入口
```

### 🔌 核心技術選擇
- **語言**: TypeScript (100%)
- **AI 模型**: Claude 3, GPT-4, Gemini Pro
- **程式碼分析**: Tree-sitter (計劃中)
- **UI 框架**: VS Code Webview API
- **測試框架**: Jest + VS Code Test Runner
- **建置工具**: TypeScript Compiler + esbuild

## 📅 開發計畫

### 🚀 Sprint 1: 建立基礎架構 (MVP)
**目標**: 建立可運作的基礎骨架，實現第一個可用的 Augment 插件
**時間**: 第 1-2 週 (20-30 小時)

#### ✅ 已完成任務
- [x] 設定專案基礎結構
- [x] 實作 ConfigManager (API 金鑰管理)
- [x] 實作 LLMService 基礎架構
- [x] 實作 TaskManager 基礎架構
- [x] 建立測試框架和 CI/CD

#### 🔄 進行中任務
- [🟡] 完善 LLM 提供商整合
- [🟡] 實作第一個 Augment 插件 (generate-contributing)
- [🟡] 建立基本 Webview UI

#### 📋 待完成任務
- [ ] 完善錯誤處理和使用者回饋
- [ ] 實作基本的程式碼分析功能
- [ ] 建立插件註冊和管理機制
- [ ] **基础用户体验优化**
  - [ ] 实现聊天自动滚动功能
  - [ ] 添加停止聊天回复功能
  - [ ] 实现代码片段选择和上下文添加
- [ ] **AI排除文件基础配置**
  - [ ] 支持 .gitignore 文件自动排除
  - [ ] 实现基础的文件排除逻辑

### ⚡ Sprint 2: 第一個 Augment 插件 + 用户体验优化
**目標**: 完成第一個完整可用的 Augment 插件并添加基础用户体验优化
**時間**: 第 3-4 週 (20-25 小时)

#### 主要任務
- [ ] 完善 `generate-contributing` 插件
- [ ] 實作 `generate-roadmap` 插件
- [ ] 建立插件預覽和確認機制
- [ ] 實作插件配置系統
- [ ] 新增插件使用統計和回饋

#### 成功標準
- 至少 2 個可用的 Augment 插件
- 插件可以正確讀取專案上下文
- 使用者可以預覽和確認生成的內容

### � Sprint 3: 代理模式核心功能
**目標**: 实现类似 Gemini Code Assist 的代理模式核心功能
**時間**: 第 5-6 週 (25-30 小时)

#### 代理模式核心功能
- [ ] **多步骤任务审核批准系统**
  - [ ] 实现交互式审查界面
  - [ ] 任务计划生成和展示
  - [ ] 用户批准/拒绝/修改机制
- [ ] **多文件并发编辑引擎**
  - [ ] 文件依赖关系分析
  - [ ] 并发编辑冲突检测
  - [ ] 批量文件修改预览
- [ ] **完整项目上下文分析**
  - [ ] 项目结构深度分析
  - [ ] 依赖关系图构建
  - [ ] 编码模式识别
- [ ] **检查点和回滚系统**
  - [ ] 文件状态快照机制
  - [ ] 变更历史记录
  - [ ] 一键回滚功能

#### 用户体验增强
- [ ] **聊天代码建议预览系统**
  - [ ] 预览区块显示代码建议
  - [ ] 可配置预览窗格设置
- [ ] **上下文抽屉管理**
  - [ ] 可视化上下文文件管理
  - [ ] 文件添加/移除功能

#### 成功標準
- 代理可以处理多步骤复杂任务
- 用户可以审核和控制每个变更
- 支持多文件并发编辑
- 具备完整的回滚机制

### �🧠 Sprint 4: 任務模組系統优化
**目標**: 實現智能任務管理和工作流自動化
**時間**: 第 7-8 週 (20-25 小時)

#### 主要任務
- [ ] 實作 TaskEngine 核心邏輯
- [ ] 建立任務狀態管理和持久化
- [ ] 實作任務優先級和排程
- [ ] 建立任務執行歷史和統計
- [ ] 實作任務模板和自動化工作流

#### 成功標準
- 任務可以自動排程和執行
- 支援複雜的多步驟工作流
- 任務執行狀態可視化

### ⚙️ Sprint 5: 配置和管理功能增强
**目標**: 实现高级配置管理和用户体验优化功能
**時間**: 第 9-10 週 (20-25 小时)

#### 配置管理功能
- [ ] **AI排除文件完整配置**
  - [ ] .aiexclude 文件完整支持
  - [ ] .gitignore 集成和自动排除
  - [ ] 文件排除规则可视化管理
- [ ] **自定义命令系统**
  - [ ] 创建和保存预配置提示
  - [ ] 自定义命令库管理界面
  - [ ] 命令模板和快速执行
- [ ] **本地代码库感知高级配置**
  - [ ] 工作区文件夹智能选择
  - [ ] 上下文窗口大小配置
  - [ ] 代码库索引优化设置

#### 用户体验完善
- [ ] **终端输出集成**
  - [ ] 终端输出添加到聊天上下文
  - [ ] 终端命令问答支持
  - [ ] 选择性终端输出功能
- [ ] **聊天交互完善**
  - [ ] 聊天中可点击文件名
  - [ ] 文件快速打开功能
  - [ ] 聊天历史管理

#### 成功標準
- 完整的文件排除和配置管理
- 自定义命令系统正常运作
- 终端集成功能完善
- 用户体验显著提升

### 🔄 Sprint 6: 工作流自動化
**目標**: 實現程式碼分析和上下文理解的核心功能
**時間**: 第 11-12 週 (15-20 小時)

#### 主要任務
- [ ] Tree-sitter 語法分析整合
- [ ] CodeParser 核心功能 (符號提取、TODO 掃描)
- [ ] CodeContextService (智能上下文提取)
- [ ] 程式碼分析功能實作

#### 成功標準
- 可以正確解析主要程式語言的語法樹
- 能夠提取函式、類別等符號資訊
- 智能上下文提取功能運作正常

### 🚀 Sprint 7: 優化與發布
**目標**: 效能優化、完善測試、準備發布
**時間**: 第 13-14 週 (10-15 小時)

#### 主要任務
- [ ] 效能優化 (啟動時間、記憶體使用)
- [ ] 完善測試覆蓋率 (目標 >80%)
- [ ] 建立完整的使用者文件
- [ ] 準備 VS Code Marketplace 發布
- [ ] 建立使用者回饋和問題追蹤機制

#### 成功標準
- 啟動時間 < 2 秒
- 記憶體使用 < 100MB
- 測試覆蓋率 > 80%
- 準備好發布到 VS Code Marketplace

## 🗺️ 版本發布路線圖

### 🚀 v0.1.0 - MVP 版本 (目標: 2024 Q1)
**目標**: 發布最小可行產品，驗證核心概念

#### 核心功能
- [x] 基礎專案架構
- [x] 配置管理系統
- [🟡] 多 LLM 整合 (Claude, OpenAI, Gemini)
- [ ] 基本程式碼分析
- [ ] 簡單任務管理
- [ ] Git commit 訊息生成

#### 技術指標
- 支援 3+ 主要 AI 模型
- 支援 TypeScript/JavaScript 分析
- 基本 Webview UI
- 核心功能測試覆蓋率 >60%

### ⚡ v0.2.0 - 智能分析版本 (目標: 2024 Q2)
**目標**: 實現智能程式碼分析和上下文理解

#### 新功能
- [ ] Tree-sitter 多語言支援
- [ ] 智能程式碼上下文提取
- [ ] 程式碼複雜度分析
- [ ] 自動 TODO/FIXME 掃描
- [ ] 改進的任務管理 UI

#### 支援語言
- TypeScript/JavaScript
- Python
- Java
- C++/C
- Go
- Rust

### 🧩 v0.3.0 - 插件生態版本 (目標: 2024 Q3)
**目標**: 建立完整的插件生態系統

#### 新功能
- [ ] 插件市場機制
- [ ] 第三方插件支援
- [ ] 插件開發 SDK
- [ ] 社群插件分享平台

### 🎯 v0.2.5 - 代理模式增强版本 (目標: 2024 Q2)
**目標**: 实现类似 Gemini Code Assist 的代理模式功能

#### 代理模式核心功能
- [ ] **多步骤任务审核批准机制**
  - 交互式审查和批准保持控制
  - 代理提供计划供用户审核
  - 用户可编辑、要求变更、批准或拒绝建议
- [ ] **多文件并发编辑功能**
  - 根据单一提示对整个代码库进行并发变更
  - 智能识别并修改所有相关文件
  - 支持大规模重构、功能实现和错误修复
- [ ] **完整项目上下文感知**
  - 全面了解整个项目的代理程序
  - 按需请求文件和文件夹
  - 基于项目架构、依赖项和编码模式的深入理解
- [ ] **恢复到检查点功能**
  - 将受影响的源文件还原到应用代码建议之前的时间点
  - 支持撤销对本地文件的变更
  - 版本控制集成

#### 用户体验优化
- [ ] **聊天代码建议预览系统**
  - 在预览区块中显示聊天代码建议
  - 可配置预览窗格设置（折叠/展开）
  - 提高生成聊天回应的可读性
- [ ] **代码片段选择和上下文**
  - 选择、附加并引导 AI 专注于代码片段
  - 支持对较小代码区块的离散分析
  - 代码片段选择功能集成
- [ ] **终端输出集成**
  - 将终端输出附加到聊天上下文
  - 支持询问有关终端命令和输出的问题
  - 终端选择输出功能
- [ ] **聊天交互优化**
  - 自动滚动聊天回复功能
  - 停止正在进行的聊天回复
  - 聊天中可点击的文件名（在IDE中打开文件）

#### 配置和管理功能
- [ ] **上下文抽屉管理系统**
  - 查看和管理请求包含在上下文中的文件和文件夹
  - 上下文抽屉可视化界面
  - 从提示上下文中移除文件的功能
- [ ] **AI排除文件配置**
  - 支持 .aiexclude 文件配置
  - .gitignore 文件自动排除
  - 从本地上下文中排除文件的预览功能
- [ ] **自定义命令系统**
  - 创建、保存并执行预配置提示
  - 自定义命令库管理
  - 重复性任务的快速执行
- [ ] **本地代码库感知配置**
  - 配置本机代码库感知功能
  - 本地工作区文件夹提示支持
  - 最多 1M 令牌上下文窗口支持

### 🚀 v1.0.0 - 正式版本 (目標: 2024 Q4)
**目標**: 穩定、高效能的正式版本

#### 新功能
- [ ] 完整的多語言支援
- [ ] 進階 AI 功能 (程式碼生成、重構建議)
- [ ] 團隊協作功能
- [ ] 企業級安全和隱私保護

## 🛠️ 開發環境設定

### 系統需求
- Node.js 16.x 或更高版本
- VS Code 1.74.0 或更高版本
- Git

### 安裝步驟
```bash
# 1. 複製專案
git clone https://github.com/satanupup/devika.git
cd devika

# 2. 安裝依賴項
npm install

# 3. 編譯 TypeScript
npm run compile

# 4. 啟動除錯模式
# 在 VS Code 中按 F5 或使用除錯面板
```

### 開發工作流
1. **程式碼風格**: 遵循 ESLint 規則
2. **測試**: 為新功能新增測試
3. **文件**: 更新相關文件
4. **提交**: 使用語義化提交訊息

## 📚 相關文件

- **[Augment 插件開發指南](docs/AUGMENT_PLUGIN_GUIDE.md)**: 詳細的插件開發教學
- **[devika-core README](devika-core/README.md)**: 核心模組說明文件

---

*最後更新: 2024-12-19*
*總預估開發時間: 120-160 小時 (新增 Gemini 启发功能)*
*適合: 個體戶或小團隊開發*
*新增功能参考: [Gemini 启发功能计划](GEMINI_INSPIRED_FEATURES.md)*
